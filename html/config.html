<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Usuario / Configuración</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <!-- Supabase JS (lib) + tu configuración global -->
  <script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
  <script src="../js/supabase-config.js" defer></script>
  <!-- Tu lógica para esta página (usa la variable global `supabase`) -->
  <script src="../js/config.js" defer></script>
</head>
<body>
  <a class="skip-link" href="#main">Saltar al contenido</a>
  <header class="topbar">
    <button id="menuBtn" class="menu-btn" aria-controls="sidebar" aria-expanded="false" aria-label="Menú">☰</button>
    <div class="logo-sm">RR.HH. Suite</div>
  </header>

  <aside id="sidebar" class="sidebar">
    <div class="logo">RR.HH. Suite</div>
    <nav class="nav" aria-label="Navegación principal">
      <div class="caption">Reclutamiento</div>
      <a href="formularioweb.html">Formulario</a>
      <div class="caption">Operación</div>
      <a href="empleados.html">Empleados</a>
      <a href="contratos.html">Contratos</a>
      <a href="nomina.html">Nómina</a>
      <div class="sep"></div>
      <div class="caption">Usuario / Configuración</div>
      <a href="config.html" class="active">Parámetros de Empresa</a>
    </nav>
  </aside>

  <div id="backdrop" class="menu-backdrop" tabindex="-1"></div>

  <main id="main" class="main" tabindex="-1">
    <div id="msg"></div>
    <div class="grid">

      <!-- EMPRESA -->
      <div class="card">
        <h2>Empresa</h2>
        <div class="row">
          <div><label>RUC</label><input id="empRuc" placeholder="20123456789"></div>
          <div><label>Razón Social</label><input id="empName" placeholder="Mi Empresa SAC"></div>
        </div>
        <label>Logo URL (opcional)</label>
        <input id="empLogo" placeholder="https://...">
        <div class="actions">
          <button id="btnEmpGuardar">Guardar/Actualizar</button>
          <button class="secondary" id="btnEmpCargar">Cargar existente</button>
        </div>
        <div class="small">Solo manejaremos 1 empresa activa (la principal).</div>
      </div>

      <!-- RÉGIMEN TRIBUTARIO -->
      <div class="card">
        <h2>Régimen Tributario</h2>
        <div class="row">
          <div>
            <label>Régimen</label>
            <select id="taxRegime"></select>
          </div>
          <div>
            <label>Vigente desde</label>
            <input id="taxValidFrom" type="date">
          </div>
        </div>
        <div class="actions">
          <button id="btnTaxSave">Guardar/Actualizar Régimen</button>
          <button class="secondary" id="btnTaxHistory">Ver historial</button>
        </div>
        <div class="small" id="taxCurrent"></div>
      </div>

      <!-- SEDES -->
      <div class="card">
        <h2>Sedes</h2>
        <div class="row">
          <div><label>Nombre de la Sede</label><input id="siteName" placeholder="Sede Lima"></div>
        </div>
        <div class="actions">
          <button id="btnSiteAdd">Agregar</button>
          <button class="secondary" onclick="openSitesModal()">Ver todo</button>
        </div>
      </div>

      <!-- PROYECTOS (sin sede) -->
      <div class="card">
        <h2>Proyectos</h2>
        <div class="row">
          <div><label>Nombre del Proyecto</label><input id="projName" placeholder="Proyecto General Lima"></div>
        </div>
        <div class="small">El código interno se genera automáticamente.</div>
        <div class="actions">
          <button id="btnProjAdd">Agregar</button>
          <button class="secondary" onclick="openProjectsModal()">Ver todo</button>
        </div>
      </div>

      <!-- TURNOS -->
      <div class="card">
        <h2>Turnos</h2>
        <div class="row3">
          <div><label>Nombre</label><input id="shiftName" placeholder="Mañana"></div>
          <div><label>Inicio</label><input id="shiftStart" type="time" value="08:00"></div>
          <div><label>Fin</label><input id="shiftEnd" type="time" value="17:00"></div>
        </div>
        <div class="actions">
          <button id="btnShiftAdd">Agregar</button>
          <button class="secondary" onclick="openShiftsModal()">Ver todo</button>
        </div>
      </div>

      <!-- USUARIOS Y PERMISOS (ACCESO A LA APP) -->
<div class="card">
  <h2>Usuarios con acceso</h2>

  <!-- INVITAR NUEVO USUARIO -->
  <fieldset>
    <legend>Invitar asistente / manager</legend>
    <div class="row3">
      <div>
        <label for="userName">Nombre completo</label>
        <input id="userName" placeholder="Ana Gómez" autocomplete="name">
      </div>
      <div>
        <label for="userEmail">Correo</label>
        <input id="userEmail" type="email" placeholder="ana@empresa.com" autocomplete="email">
      </div>
      <div>
        <label for="userRole">Rol</label>
        <select id="userRole" aria-label="Rol de acceso">
          <option value="manager">Manager</option>
          <option value="employee">Empleado (con acceso)</option>
          <option value="admin">Admin</option>
        </select>
      </div>
    </div>

    <!-- Permisos por módulo (opcional) -->
    <details id="permOpt" class="mt-2">
      <summary>Permisos avanzados (opcional)</summary>
      <div class="perm-grid mt-1">
        <div class="perm-col">
          <div class="caption">Empleados</div>
          <label class="chk"><input type="checkbox" id="permEmpRead" checked> Leer</label>
          <label class="chk"><input type="checkbox" id="permEmpWrite"> Escribir</label>
        </div>
        <div class="perm-col">
          <div class="caption">Contratos</div>
          <label class="chk"><input type="checkbox" id="permCtrRead" checked> Leer</label>
          <label class="chk"><input type="checkbox" id="permCtrWrite"> Escribir</label>
        </div>
        <div class="perm-col">
          <div class="caption">Nómina</div>
          <label class="chk"><input type="checkbox" id="permNomRead" checked> Leer</label>
          <label class="chk"><input type="checkbox" id="permNomWrite"> Escribir</label>
        </div>
      </div>
      <div class="small mt-1">
        Si no tocas esto, aplicaremos los permisos por defecto del rol elegido.
      </div>
    </details>


    <div class="actions">
      <button id="btnInviteUser">Enviar invitación</button>
      <button class="secondary" id="btnInviteReset">Limpiar</button>
    </div>
    <div id="inviteMsg" class="small" role="status" aria-live="polite"></div>
  </fieldset>

  <!-- LISTADO DE USUARIOS CON ACCESO -->
  <h3 class="mt-2">Equipo con acceso</h3>
  <div class="row">
    <div class="grow">
      <input id="userFilter" type="search" placeholder="Buscar por nombre o correo…">
    </div>
    <div>
      <button class="secondary" id="btnUsersReload" title="Recargar">↻</button>
    </div>
  </div>

  <div id="usersList" class="mt-1" role="table" aria-label="Usuarios con acceso">
    <!-- Se llena por JS: filas con nombre, correo, rol, estado y acciones -->
    <!-- Estructura de fila (ejemplo):
      <div class="list-row" role="row">
        <div class="cell name" role="cell">Ana Gómez</div>
        <div class="cell email" role="cell">ana@empresa.com</div>
        <div class="cell role" role="cell">
          <select data-user-id="..." class="user-role">
            <option>admin</option>...
          </select>
        </div>
        <div class="cell status" role="cell"><span class="badge badge--pending">Pendiente</span></div>
        <div class="cell actions" role="cell">
          <button class="small" data-act="resend" data-user-id="...">Reenviar</button>
          <button class="small" data-act="toggle" data-user-id="...">Desactivar</button>
          <button class="small danger" data-act="remove" data-user-id="...">Quitar</button>
        </div>
      </div>
    -->
  </div>

  <div class="pager">
    <button class="secondary" id="usersPrev">« Prev</button>
    <span id="usersPageInfo" class="small"></span>
    <button class="secondary" id="usersNext">Next »</button>
  </div>

  <div class="small">
    Nota: solo los <strong>admins</strong> pueden invitar, cambiar roles y quitar accesos.
  </div>
</div>


    </div>
  </main>

  <!-- MODAL reutilizable -->
  <div id="modalWrap" class="modal-backdrop">
    <div class="modal">
      <header>
        <h3 id="modalTitle">Listado</h3>
        <div>
          <input id="modalSearch" type="search" placeholder="Buscar…">
          <button class="secondary" onclick="closeModal()">Cerrar</button>
        </div>
      </header>
      <div id="modalContent"></div>
      <div class="pager">
        <button class="secondary" id="modalPrev">« Prev</button>
        <span id="modalPageInfo" class="small"></span>
        <button class="secondary" id="modalNext">Next »</button>
      </div>
    </div>
  </div>
</body>
</html>








