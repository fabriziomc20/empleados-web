<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Reclutamiento – Formulario</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{--bg:#0f172a;--panel:#111827;--text:#e5e7eb;--muted:#94a3b8;--brand:#2563eb;}
  *{box-sizing:border-box} body{margin:0;display:flex;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
  .sidebar{width:260px;background:#0b1220;min-height:100vh;padding:18px;position:sticky;top:0}
  .logo{font-weight:700;margin-bottom:14px}
  .nav a{display:block;padding:10px 12px;border-radius:10px;color:var(--text);text-decoration:none;margin:6px 0}
  .nav a.active{background:var(--brand)} .nav a:hover{background:#1f2937}
  .main{flex:1;padding:20px}
  .card{background:var(--panel);padding:18px;border-radius:14px;max-width:1100px}
  h1{margin:6px 0 14px} label{display:block;margin-top:10px;font-size:14px;color:var(--muted)}
  input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:var(--text)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .actions{display:flex;gap:10px;margin-top:14px}
  button{background:var(--brand);border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
  button.secondary{background:#374151}
  .drop{border:2px dashed #475569;border-radius:12px;padding:14px;text-align:center;margin-top:10px;cursor:pointer;background:#0b1220}
  .file-list{list-style:none;margin:6px 0 0;padding:0}
  .file-list li{display:flex;justify-content:space-between;gap:8px;padding:6px 8px;border:1px solid #374151;border-radius:8px;margin:6px 0}
  .file-list button{background:#374151;border:none;color:#e5e7eb;padding:4px 8px;border-radius:6px;cursor:pointer}
  #msg{display:none;margin:12px 0;padding:10px;border-radius:10px}
  .ok{background:#065f46;color:#ecfdf5} .err{background:#7f1d1d;color:#fee2e2}
</style>
</head>
<body>

<aside class="sidebar">
  <div class="logo">RR.HH. Suite</div>
  <nav class="nav">
    <div style="font-size:12px;opacity:.7;margin:8px 0">Reclutamiento</div>
    <a href="formularioweb.html" class="active">Formulario</a>
    <a href="consulta.html">Consulta</a>
    <div style="font-size:12px;opacity:.7;margin:12px 0 6px">Operación</div>
    <a href="empleados.html">Empleados</a>
    <a href="contratos.html">Contratos</a>
    <a href="nomina.html">Nómina</a>
  </nav>
</aside>

<main class="main">
  <div class="card">
    <h1>Formulario de Candidato</h1>
    <div id="msg"></div>

    <form id="formEmpleado">
      <div class="row">
        <div><label>DNI</label><input type="text" name="dni" required maxlength="12" /></div>
        <div><label>Grupo</label><input type="text" name="grupo" /></div>
        <div><label>Apellido Paterno</label><input type="text" name="apellido_paterno" required /></div>
        <div><label>Apellido Materno</label><input type="text" name="apellido_materno" required /></div>
        <div><label>Nombres</label><input type="text" name="nombres" required /></div>
        <div><label>Sede</label><input type="text" name="sede" /></div>
        <div><label>Turno / Horario</label><input type="text" name="turno_horario" placeholder="Mañana (08:00-16:00)" /></div>
      </div>

      <label>DNI (PDF/JPG/PNG)</label>
      <div class="drop" id="dniDrop">Arrastra aquí o haz clic</div>
      <input type="file" id="dniInput" name="dni" accept=".pdf,.jpg,.jpeg,.png" multiple hidden>
      <ul id="dniList" class="file-list"></ul>

      <label>Certificados</label>
      <div class="drop" id="certificadosDrop">Arrastra aquí o haz clic</div>
      <input type="file" id="certificadosInput" name="certificados" accept=".pdf,.jpg,.jpeg,.png" multiple hidden>
      <ul id="certificadosList" class="file-list"></ul>

      <label>Antecedentes</label>
      <div class="drop" id="antecedentesDrop">Arrastra aquí o haz clic</div>
      <input type="file" id="antecedentesInput" name="antecedentes" accept=".pdf,.jpg,.jpeg,.png" multiple hidden>
      <ul id="antecedentesList" class="file-list"></ul>

      <label>Documentos Médicos</label>
      <div class="drop" id="medicosDrop">Arrastra aquí o haz clic</div>
      <input type="file" id="medicosInput" name="medicos" accept=".pdf,.jpg,.jpeg,.png" multiple hidden>
      <ul id="medicosList" class="file-list"></ul>

      <label>Certificados de Capacitación</label>
      <div class="drop" id="capacitacionDrop">Arrastra aquí o haz clic</div>
      <input type="file" id="capacitacionInput" name="capacitacion" accept=".pdf,.jpg,.jpeg,.png" multiple hidden>
      <ul id="capacitacionList" class="file-list"></ul>

      <label>CV</label>
      <div class="drop" id="cvDrop">Arrastra aquí o haz clic</div>
      <input type="file" id="cvInput" name="cv" accept=".pdf,.doc,.docx" hidden>
      <ul id="cvList" class="file-list"></ul>

      <div class="actions">
        <button type="submit">Guardar</button>
        <button type="button" class="secondary" id="btnReset">Limpiar</button>
      </div>
    </form>
  </div>
</main>

<script>
document.querySelectorAll('.nav a').forEach(a=>{
  if (a.getAttribute('href') && location.pathname.endsWith(a.getAttribute('href'))) a.classList.add('active');
});
function showMsg(type, text){ const box=document.getElementById('msg'); box.className=type==='ok'?'ok':'err'; box.textContent=text; box.style.display='block'; }
function fmtSize(b){ return b<1024?`${b} B`:b<1048576?`${(b/1024).toFixed(1)} KB`:`${(b/1048576).toFixed(1)} MB`; }

function initDropzone({inputId, dropId, listId, multiple=true}){
  const input=document.getElementById(inputId), drop=document.getElementById(dropId), list=document.getElementById(listId);
  input._dt=new DataTransfer();
  const openPicker=()=>input.click();
  drop.addEventListener('click', openPicker); drop.addEventListener('dblclick', openPicker);
  ['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.style.background='#1f2937'}));
  ['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.style.background=''}));
  drop.addEventListener('drop',e=>addFiles(Array.from(e.dataTransfer.files||[])));
  input.addEventListener('change',()=>addFiles(Array.from(input.files||[])));
  function addFiles(files){ for(const f of files){ if(!multiple && input._dt.files.length>0){ input._dt=new DataTransfer(); } input._dt.items.add(f); }
    input.files=input._dt.files; renderList(); }
  function removeAt(idx){ const dt=new DataTransfer(); Array.from(input._dt.files).forEach((f,i)=>{ if(i!==idx) dt.items.add(f); });
    input._dt=dt; input.files=input._dt.files; renderList(); }
  function renderList(){ list.innerHTML=''; Array.from(input._dt.files).forEach((f,i)=>{ const li=document.createElement('li');
    li.innerHTML=`<span title="${f.name}">${f.name} · ${fmtSize(f.size)}</span>`; const btn=document.createElement('button'); btn.type='button'; btn.textContent='❌ Quitar';
    btn.addEventListener('click',()=>removeAt(i)); li.appendChild(btn); list.appendChild(li); }); }
  return { clear:()=>{ input._dt=new DataTransfer(); input.files=input._dt.files; list.innerHTML=''; } };
}
const dzDni=initDropzone({inputId:'dniInput',dropId:'dniDrop',listId:'dniList',multiple:true});
const dzCertificados=initDropzone({inputId:'certificadosInput',dropId:'certificadosDrop',listId:'certificadosList',multiple:true});
const dzAntecedentes=initDropzone({inputId:'antecedentesInput',dropId:'antecedentesDrop',listId:'antecedentesList',multiple:true});
const dzMedicos=initDropzone({inputId:'medicosInput',dropId:'medicosDrop',listId:'medicosList',multiple:true});
const dzCapacitacion=initDropzone({inputId:'capacitacionInput',dropId:'capacitacionDrop',listId:'capacitacionList',multiple:true});
const dzCV=initDropzone({inputId:'cvInput',dropId:'cvDrop',listId:'cvList',multiple:false});

const API_BASE = "https://empleados-api-XXXX.onrender.com"; // <--- CAMBIA
const API_CANDIDATOS = `${API_BASE}/api/candidatos`;

document.getElementById('formEmpleado').addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  const fd = new FormData(ev.target);
  try{
    const res = await fetch(API_CANDIDATOS, { method:"POST", body: fd });
    if(!res.ok){ const clone=res.clone(); let detalle="";
      try{ const d=await clone.json(); detalle=d?.error||JSON.stringify(d) }catch{ try{ detalle=await clone.text(); }catch{} }
      throw new Error(`HTTP ${res.status} – ${detalle||'Error'}`); }
    showMsg('ok','Candidato registrado');
    dzDni.clear(); dzCertificados.clear(); dzAntecedentes.clear(); dzMedicos.clear(); dzCapacitacion.clear(); dzCV.clear();
    ev.target.reset();
    // setTimeout(()=> location.href='consulta.html', 600); // opcional
  }catch(e){ console.error(e); showMsg('err',`Error al enviar: ${e.message}`); }
});
document.getElementById('btnReset').addEventListener('click',()=>{
  dzDni.clear(); dzCertificados.clear(); dzAntecedentes.clear(); dzMedicos.clear(); dzCapacitacion.clear(); dzCV.clear();
  document.getElementById('formEmpleado').reset();
});
</script>
</body>
</html>







